# 概论作业4 (Oct/11/2017)
### **内容：** ###
### 1.解释作业、进程、线程的概念，进程和线程概念的提出分别解决了什么问题？
#### 概念解释：  
**作业**是用户向计算机提交的任务实体。它是计算机一次计算或事务处理中用户要求计算机所做的工作的集合。一个作业可以包括一个进程或一组进程。  
**进程**是计算机为完成用户任务实体而设置的执行实体。它是具有一定独立功能的程序关于某个数据集合上的一次运行活动，也是操作系统进行资源分配和调度的一个独立单位。一个进程可以包括多个线程。[4]  
**线程**是进程的组成部分。它是CPU调度和分派的基本单位。线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源（如程序计数器,一组寄存器和栈）,但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。[4]  
#### 解决的问题：  
进程的出现，使得程序运行的当前状态得以保存，这样CPU在执行其他任务时，该程序的数据不会丢失。因此，一个任务可以在等待I/O时把空闲的CPU交给其他任务使用，等到I/O完成后再继续使用CPU，同时不影响任务的运行。多个任务如此轮换运行，如同CPU同时执行多个任务，大大提高了计算时间的利用率，由此催生出“多任务”操作系统。  
线程的出现，可以节省内存空间，因同一进程的多个线程可以共享内存，故创建和结束线程的空间开销比创建和结束进程的空间开销更小；同时如果有多个任务需要CPU处理时，使用线程可以减少CPU的切换时间，从而进一步降低耗时。

### 2.描述哲学家就餐问题及解法，说明同步、互斥、死锁、活锁的概念。
哲学家就餐问题最初是Dijkstra于1965年提出的考试题，题意大致如下：[1]  

> 五个沉默寡言的哲学家围在圆桌旁吃意大利面，他们互相都不交流。每两位哲学家之间都有一把用于吃面的叉子。他们吃面时必须满足如下规则：  
>
> 1. 任意时刻，一把叉子只能被一个哲学家持有（也即两个哲学家不能同时共用一把叉子）；
> 2. 每个哲学家都会交替着思考和吃饭，且只有当他们左右手都有一把叉子才能吃面；
> 3. 如果有个哲学家吃完了面，那么他必须把两把叉子同时放下给别的哲学家用；
> 4. 每个哲学家都可以在任意时刻拿起左手边或右手边的无人使用的叉子，且同一时刻只能拿起一把叉子（即先拿左边的叉子，后拿右边的叉子，或先拿右边的叉子，后拿左边的叉子），只有当左右手都拿到叉子时，他们才能吃面。
>
> 假设他们的食量无限大，且意大利面的量无限，则问：在不互相交流的情况下，该如何设计一个拿叉子的规则，使得五个哲学家不会被饿扁（如果有哲学家被饿扁，其他哲学家将有被扔书本、扔显示器、扔Surface Pro，乃至真人PK的危险），也即哲学家在不知道其他哲学家是否想吃面的情况下，仍能交替的思考和吃面而不被打断。  

在解决这个问题之前，我们先解释一下操作系统中同步、互斥、死锁、活锁等概念。  

**同步：**  
通常情况下，各个进程是异步执行的，不存在时序要求。然而有时候会出现如下情形：[2]  
1. 作业的拆分和合并，即一个作业拆分成多个子作业，每个子作业都有相应的任务，等到所有的子作业完成后再重新合并；  
2. 下游的进程必须要等待上游的进程返回合适的结果才能执行；  
3. 排他性的资源使用，即多个进程要访问同一资源，然而如果同时访问该资源有可能导致系统异常乃至崩溃，于是操作系统要保证在每个时刻只有一个处理器使用该资源。  
因此，要求它们必须按某种特定顺序执行，并且遵守如下两种限制：[5]  

> 1. R 1（**顺序化执行**）：进程A的eventA事件必须发生在进程B的eventB事件之前； 
> 2. R 2（**互斥执行**）：进程A的eventA事件与进程B的eventB事件不能同时发生。
  
把上述限制下多进程的运行状态叫作进程的**同步执行**。同步的最常见实现方法就是加锁，即在某个时刻，资源只能被一个程序或一段代码访问。  
**饥饿：**  
一个进程等待访问某个资源却长时间分配不到，以至于给进程推进和响应带来明显影响。[2]  
**死锁：**  
意为一组进程中的每个进程都在等待其他进程的反馈，如发送消息或解锁[3]。常见表现为当多个进程同时等待访问同一资源，而这个资源正被其他进程使用时，这些等待的进程将一直等待而不执行。[2]    
**活锁：**  
类似于死锁，都是进程无任何推进，与死锁不同的是，死锁中进程状态是僵持不变的，而活锁中进程状态不断变化[3]。常见的表现为多个进程同时等待访问同一资源，而为了使用该资源，又不得不释放已有的资源。  
**优先级反转：**  
当优先级高的进程请求访问某个资源，而该资源被优先级低的进程占用时，优先级高的进程必须要等待优先级低的进程释放该资源。[2]  
**繁忙等待（干等）：**  
某个进程一直申请访问某个资源，导致其他进程一直无法访问该资源。[2]  

对应于哲学家就餐问题，情形如下（仿自[7]）：  
**同步：**  
同一时刻，一把叉子只能被一个哲学家持有，且哲学家必须先拿起一边的叉子，再拿另一边的叉子。  
**死锁：**  
所有哲学家都拿起左手边的叉子，然后大家都希望其他哲学家能放下手中的叉子而自己不放下，这样自己就可以抢到另一把叉子吃面。于是大家都不放下手中的叉子，都吃不了面。  
**活锁：**  
所有哲学家都拿起左手边的叉子，然后大家都很仁慈，都放下了叉子，结果看到桌上又有叉子，于是又同时开始拿起左手边叉子，又同时放下，如此反复而吃不了面。  
**繁忙等待（干等）：**  
五个哲学家都拥有心灵操控的能力，且发动心灵操控时其他人不能自主使用心灵操控，于是每当有个哲学家想拿起叉子，就用心灵操控使其他哲学家无法拿起叉子，然后分别拿起两边的叉子独享意大利面，吃完后放下叉子，然后停止心灵操控。这样一来，在该哲学家独享意大利面时，其他哲学家只能干瞪眼，而实际上桌上的叉子足够让两个哲学家享用意大利面，因而造成叉子的巨大浪费。

为了解决这个问题，科学家提出了以下解法[1][5]：  
#### (1) 资源分级解法
该解法定义资源的优先级，且一个进程必须先拿得优先级高的资源，才能拿优先级低的资源。  
在哲学家就餐问题中，我们可以把叉子编号为1到5，并规定所有哲学家i必须先拿左边（编号为i）的叉子，再拿右边（编号为(i%5)+1）的叉子。如果右边的叉子被右边的哲学家(i%5+1)占用，则比较这两位哲学家拿到左边叉子的早晚，晚拿的哲学家必须放下左手的叉子，再试图拿左边的叉子。  
这个方法虽然避免了死锁，却有一个缺点：如果计划访问的资源无法预先知道优先级，那么该进程很有可能会“功亏一篑”，例如某个进程已经有优先级为3和5的资源，接下来它又获取了优先级为2的资源，如果规定数字越小优先级越高，那么这个进程要先丢掉优先级为3和5的资源以获取优先级为2的资源，再拿优先级为3的资源，最后拿优先级为5的资源，这样就会造成极大的时间和资源浪费。  
#### (2) Chandy/Misra解法  
1984年，K. Mani Chandy和J. Misra提出了哲学家就餐问题的另一个解法，允许任意的用户（编号P1, ..., Pn）争用任意数量的资源。与资源分级解法不同的是，这里编号可以是任意的。但是这种解法违背了哲学家不能交流的规则（因为原题已阐明这五个哲学家都沉默寡言，互不交流）。解法如下:  

> 1. 对每一对竞争一个资源的哲学家，新拿一个餐叉，给编号较低的哲学家。每只餐叉都是“干净的”或者“脏的”。最初，所有的餐叉都是脏的。
> 2. 当一位哲学家要使用资源（也就是要吃东西）时，他必须从与他竞争的邻居那里得到。对每只他当前没有的餐叉，他都发送一个请求。  
> 3. 当拥有餐叉的哲学家收到请求时，如果餐叉是干净的，那么他继续留着，否则就擦干净并交出餐叉。
> 4. 当某个哲学家吃东西后，他的餐叉就变脏了。如果另一个哲学家之前请求过其中的餐叉，那他就擦干净并交出餐叉。  

这个解法允许很大的并行性，适用于任意大的问题。  
#### (3) 信号量机制解法  
该解法依赖于抽屉原理：  

> 如果系统有N个进程，且每个进程都要申请R个同种资源，那么只要系统准备N×(R-1)+1个该资源，就不会出现死锁。  

这是因为若分配的资源不多于N×(R-1)个，那么会出现“每个进程都拿到(R-1)个资源”的极端死锁情况，这时再加入一个资源，就有一个进程申请到R个资源而可以执行。  
在哲学家就餐问题中，我们可以设信号量为4，即同一时刻最多允许4个哲学家拿起叉子。当一个手上没有叉子的哲学家试图拿起一把没人用的叉子时，如果信号量为0，则不能拿叉子，否则拿起一把叉子，同时信号量减1；而一个手上有叉子的哲学家试图拿起一把没人用的叉子时，信号量不减少。这样就保证至少有一个哲学家拿到两把叉子而吃到面。  
#### (4) 服务员解法（类似于信号量机制解法）
在哲学家就餐问题中，我们可以雇佣一个服务员，当哲学家想拿叉子时，必须向服务员提出申请。服务员每次只能服务一个哲学家，直至哲学家左右手都拿到了叉子。  
作为范例，假设哲学家依次标号为A至E。如果A和C在吃东西，则有四只餐叉在使用中。B坐在A和C之间，所以两只餐叉都无法使用，而D和E之间有一只空余的餐叉。假设这时D想要吃东西。如果他拿起了第五只餐叉，就有可能发生死锁。相反，如果他征求服务生同意，服务生会让他等待。这样，我们就能保证下次当两把餐叉空余出来时，一定有一位哲学家可以成功的得到一对餐叉，从而避免了死锁。该解法可以用互斥锁实现。  
然而，该解法也有很大缺点。首先，该解法引入了外部的变量（服务员）；其次，该解法大大降低了并行性，即如果有一个哲学家在吃面，而旁边的哲学家申请拿叉子，那么尽管有无人使用的叉子，其他哲学家必须等待，直到该申请结束。
#### (5) 附加竞争规则解法
在哲学家就餐问题中，我们同样把叉子编号为1到5，并添加一条竞争规则：所有哲学家必须先竞争奇数编号的叉子，拿到奇数编号的叉子后才能竞争偶数编号的叉子（由于5号哲学家左右都是奇数号叉子，在本文中规定他先竞争5号叉子），这样的话就总会有一名哲学家可以顺利获得两把叉子开始进餐。

### 3.了解磁盘、分区、简单卷、跨区卷等磁盘管理中的概念。
**磁盘**是计算机存放信息的主要存储设备之一，它运用电流的磁效应，将数据存储在一片或多片旋转的盘片表面。如今随着闪存技术的发展，固态硬盘已成为存储设备的主流，因此“磁盘”一词的外延有所扩大，当“磁盘”指装在电脑内的外部存储设备时，意义与 **硬盘** 相近。  
一块磁盘（硬盘）不能直接用于存储，它必须被操作系统通过分区编辑器划分为几个区域，这样便于操作系统在不同区域分别管理（例如系统区单独放一个区，那么其他区就不会受到系统碎片的影响）。磁盘（硬盘）上分隔出来的这几个区域就叫做**磁盘分区**。  
磁盘分区可分为 **主分区** 和 **扩展分区** 。一个磁盘最多只能有四个主分区，扩展分区可以没有，最多一个，且主分区和扩展分区合起来不能超过四个。扩展分区不能直接使用，必须在扩展分区中划分出**逻辑分区**。逻辑分区可以有多个。  
Windows支持 **“动态磁盘”** ，与“基本磁盘”相比，“动态磁盘”可以不限制卷数，而且可以调节分区大小。  
Windows支持五种类型的动态卷：简单卷、跨区卷、带区卷、镜像卷和RAID-5卷。  
**简单卷**是由基本磁盘转化过来的，基本磁盘转化为动态磁盘后，所有的主分区和逻辑分区就变成了简单卷。  
**跨区卷**是把其他磁盘上的空余空间组合成一个比较大的逻辑卷，也就是说把其他磁盘上未分配的空间组成一个跨区卷。存储信息时，跨区卷会先存储完其中一个成员的磁盘，再存储到下一个。跨区卷的成员不能有系统卷和启动卷。  
**带区卷** 与 **跨区卷**相似，也是由两块或两块以上的磁盘（硬盘）组成，但每块磁盘所贡献的空间大小必须相同，带区卷上的数据以交替平均的方式分配到每块磁盘中，大大提高了I/O性能，但容错率低，如果其中一块硬盘损坏，那么整个带区卷都将损坏。  
**镜像卷**是在两个物理磁盘上复制数据的容错卷。它通过使用卷的副本（镜像）复制该卷中的信息来提供数据冗余，镜像总位于另一个磁盘上。如果其中一个物理磁盘出现故障，则该故障磁盘上的数据将不可用，但是系统可以使用未受影响的磁盘继续操作。  
**RAID-5卷**是一种存储性能、数据安全和存储成本兼顾的存储解决方案。RAID-5可以理解为是RAID-0和RAID-1的折中方案。RAID-5可以为系统提供数据安全保障，但保障程度要比镜像卷低而磁盘空间利用率要比镜像卷高。RAID-5具有和RAID-0相近似的数据读取速度，只是多了一个奇偶校验信息，写入数据的速度比对单个磁盘进行写入操作稍慢。同时由于多个数据对应一个奇偶校验信息，RAID-5的磁盘空间利用率要比RAID-1高，存储成本相对较低，是目前运用较多的一种解决方案。[6][8]
### Reference:
[1] Dining philosophers problem, Wikipedia, <https://en.wikipedia.org/wiki/Dining_philosophers_problem>  
[2] Synchronization (computer science), Wikipedia, <https://en.wikipedia.org/wiki/Synchronization_(computer_science)>  
[3] Deadlock, Wikipedia, <https://en.wikipedia.org/wiki/Deadlock>  
[4] 进程和线程关系及区别, yaosiming2011的专栏, CSDN博客， <http://blog.csdn.net/yaosiming2011/article/details/44280797>  
[5] 哲学家就餐问题的分析与解决方案, Sunflowerfiona的博客, CSDN博客, <http://blog.csdn.net/sunflowerfiona/article/details/52756819>  
[6] 简单卷、跨区卷、带区卷、镜像卷和RAID-5的区别, Fallen丶J, 博客园, <http://www.cnblogs.com/fallen/p/4792894.html>  
[7] 哲学家进餐问题解析, Rorschach's Journal, 博客园, <http://www.cnblogs.com/pan89/p/3772671.html>  
[8] 简单卷 跨区卷 带区卷 镜像卷 的区别, 百度知道, <https://zhidao.baidu.com/question/477094482.html?qbl=relate_question_0&word=%B4%F8%C7%F8%BE%ED%BA%CD%BF%E7%C7%F8%BE%ED%B5%C4%C7%F8%B1%F0>